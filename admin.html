<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/index.css">
    <link rel="icon" href="img/logo.jpg" />
    <title>GarageB - Painel do Radialista</title>
</head>

<body id="conectar_pag">

    <header>
        <div id="cabecalho">
            <div class="logo"></div>
            <nav class="menu-site menu-desktop">
                <a href="conectar.html">Voltar</a>
                <a href="index.html">Home</a>
            </nav>

            <button class="menu-hamburguer" aria-label="Abrir Menu">&#9776;</button>

            <nav class="menu-mobile">
                <a href="conectar.html">Voltar</a>
                <a href="index.html">Home</a>
            </nav>
        </div>
    </header>

    <main class="admin-panel-section">

        <h1 class="page-title">Painel de Controle do Radialista</h1>

        <div class="channel-management-container">

            <div class="management-box playlist-control">
                <h3>üìª Controle de Playlist e Reprodu√ß√£o</h3>

                <p>M√∫sica Atual: <span id="current-song-display" style="font-weight: bold; color: green;">Carregando...</span></p>

                <audio id="admin-audio-player" controls preload="none" style="width: 100%; margin-bottom: 10px;">
                    Seu navegador n√£o suporta o elemento de √°udio.
                </audio>
                
                <div class="playback-controls" style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button id="btn-remote-play" class="btn-action primary" style="flex-grow: 1;">‚ñ∂Ô∏è Play Remoto</button>
                    <button id="btn-remote-pause" class="btn-action warning" style="flex-grow: 1;">‚è∏Ô∏è Pause Remoto</button>
                </div>
                
                <div class="playlist-controls">
                    <h4>Escolha e Envie a Pr√≥xima M√∫sica:</h4>
                    <button class="btn-playlist-select" data-song="musica_01.mp3">1. Classic Rock</button>
                    <button class="btn-playlist-select" data-song="musica_02.mp3">2. Hard Rock</button>
                    <button class="btn-playlist-select" data-song="musica_03.mp3">3. Heavy Metal</button>
                </div>

                <button id="btn-sync-all" class="btn-action primary" style="background-color: #007bff; margin-top: 20px;">
                    üì° SINCRONIZAR OUVINTES AGORA
                </button>
            </div>

            <div class="management-box channel-focus">
                <h3>üè†üõ£Ô∏è Foco da R√°dio e Comandos de Stream</h3>

                <p>Foco Atual: <span id="current-focus-display" style="font-weight: bold; color: orange;">CASA</span></p>

                <div class="channel-focus-controls">
                    <h4>Mudar Foco para Ouvintes:</h4>
                    <button id="btn-focus-casa" class="btn-action primary">Foco: R√°dio CASA</button>
                    <button id="btn-focus-rua" class="btn-action warning">Foco: R√°dio RUA</button>
                </div>

                <h4 style="margin-top: 20px;">Comandos Avan√ßados:</h4>
                <button id="btn-restart-stream" class="btn-action warning">Reiniciar Stream (For√ßar Recarga)</button>
            </div>

        </div>

        <p class="admin-note">
            ‚ö†Ô∏è **Nota:** Use os bot√µes 'Play/Pause Remoto' para controlar o fluxo de √°udio para os ouvintes.
        </p>

    </main>


    <footer>
        <p id="texto_rodape">&copy; 2025 GarageB. Todos os direitos reservados.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const menuHamburguer = document.querySelector('.menu-hamburguer');
            const menuMobile = document.querySelector('.menu-mobile');
            menuHamburguer.addEventListener('click', () => { menuMobile.classList.toggle('active'); });
            document.querySelectorAll('.menu-mobile a').forEach(link => { link.addEventListener('click', () => { menuMobile.classList.remove('active'); }); });
        });
    </script>
    
    <script src="/socket.io/socket.io.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const socket = io(); 

            // Elementos DOM
            const currentSongDisplay = document.getElementById('current-song-display');
            const currentFocusDisplay = document.getElementById('current-focus-display');
            const btnSyncAll = document.getElementById('btn-sync-all');
            const btnFocusCasa = document.getElementById('btn-focus-casa');
            const btnFocusRua = document.getElementById('btn-focus-rua');
            const btnRestartStream = document.getElementById('btn-restart-stream');
            const songButtons = document.querySelectorAll('.btn-playlist-select');
            
            const adminAudioPlayer = document.getElementById('admin-audio-player');
            const btnRemotePlay = document.getElementById('btn-remote-play');
            const btnRemotePause = document.getElementById('btn-remote-pause');
            const STREAM_URL = "http://localhost:3000/audio/stream";


            // Define o player do Admin para o stream do servidor
            adminAudioPlayer.src = STREAM_URL;
            adminAudioPlayer.load();
            
            // Recebe o estado inicial do servidor 
            socket.on('initial_state', (state) => {
                currentSongDisplay.textContent = state.song;
                currentFocusDisplay.textContent = state.channel.toUpperCase();
                adminAudioPlayer.src = STREAM_URL;
                adminAudioPlayer.load();
            });


            // --- 1. COMANDOS DE PLAYLIST (Trocar M√∫sica) ---
            songButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const newSong = this.getAttribute('data-song');
                    
                    // 1. Envia o comando para o servidor
                    socket.emit('change_song', newSong); 
                    
                    // 2. Atualiza o painel e recarrega o player local do Admin
                    currentSongDisplay.textContent = newSong;
                    adminAudioPlayer.src = STREAM_URL; 
                    adminAudioPlayer.load();
                    
                    // 3. Envia Play remoto para todos os ouvintes
                    socket.emit('remote_playback_control', 'play');

                    alert(`Comando enviado: Tocar ${newSong} e Play Remoto!`);
                });
            });

            // --- 2. COMANDOS DE PLAY/PAUSE REMOTO ---
            btnRemotePlay.addEventListener('click', function() {
                adminAudioPlayer.play(); // Play no player local (intera√ß√£o do usu√°rio)
                socket.emit('remote_playback_control', 'play'); // Comando para Ouvintes
                alert("Play Remoto enviado!");
            });

            btnRemotePause.addEventListener('click', function() {
                adminAudioPlayer.pause(); // Pause no player local
                socket.emit('remote_playback_control', 'pause'); // Comando para Ouvintes
                alert("Pause Remoto enviado!");
            });


            // --- 3. COMANDO DE SINCRONIA GLOBAL ---
            btnSyncAll.addEventListener('click', function() {
                const syncTime = 0; 
                
                // Sincroniza o player LOCAL do Admin primeiro
                adminAudioPlayer.currentTime = 0;
                
                // Envia a posi√ß√£o de sincronia (0) para o servidor Node.js (Ouvintes)
                socket.emit('sync_request', syncTime); 
                
                alert("Comando de Sincroniza√ß√£o Global enviado!");
            });


            // --- 4. COMANDOS DE FOCO DO CANAL e RESTART ---
            btnFocusCasa.addEventListener('click', function() {
                const channel = 'casa';
                socket.emit('change_channel', channel);
                currentFocusDisplay.textContent = channel.toUpperCase();
                alert(`Foco da R√°dio alterado para CASA.`);
            });

            btnFocusRua.addEventListener('click', function() {
                const channel = 'rua';
                socket.emit('change_channel', channel);
                currentFocusDisplay.textContent = channel.toUpperCase();
                alert(`Foco da R√°dio alterado para RUA.`);
            });
            
            btnRestartStream.addEventListener('click', function() {
                alert("Comando de 'Reiniciar Stream' enviado. Ouvintes ser√£o for√ßados a recarregar!");
                socket.emit('restart_stream', currentFocusDisplay.textContent.toLowerCase());
            });


        });
    </script>

</body>

</html>